<h1>Edit <%= @generic_file.title.join(' | ') %></h1>

<%= render :partial => 'media_display' %>

<div class="viewing_context">
  <%= link_to "Browse view", generic_file_path %>
</div>

<%= form_for @generic_file, :url => generic_file_path, :html => {:multipart => true, :class => 'form-horizontal', :id => 'fileupload'} do |f| %>
<div class="uploader-contents">
  <div class="row">
    <div class="span3">
      <h2>Revisions</h2>
    </div>
    <div class="span9">
      <h3>Revision history</h3>
      <% @generic_file.content.versions.each_with_index do |version, index| %>
        <%= radio_button_tag(:revision, version.versionID, index == 0) %>
        <%= label_tag("revision_#{version.versionID}".to_sym, "Restore version from #{version.dsCreateDate}") %>
      <% end %>
      <h3>New revision</h3>
      <p>Upload a new version of this file from your computer.</p>
      <p id="upload_field">
      <%= file_field_tag "filedata"  %>
      </p>
    </div> <!-- close .span9 -->
  </div><!-- close .row choose file section-->
    <div class="span3">
      <h2>Audit</h2>
    </div>
    <div class="span9">
      Audit status: <%= @generic_file.audit_stat  %><br />
      Date Uploaded: <%= @generic_file.date_uploaded.first %> <br />
      Date Modified: <%= @generic_file.date_modified.first %> <br />
    </div>
  </div>
  <div class="row">
    <div class="span3">
        <h2>Description(s)</h2>
    </div>
    <div class="span9">
      <div class="control-group" id="public_permissions">
        <%= f.label :public_group_access, "Public Access", :class=>"control-label" %>
        <div class="controls">
          <select id="generic_file_public_group_access" name="permission[group][public]" class="span2">
          <% choices = {"No Access"=>"none", "Discover" => "discover", "Read &amp; Download" => "read" } %>
            <% choices.each_pair do |label, name| %>
                <option value="<%=h name %>">
                   <%= label.html_safe %>
                </option>
          <% end %>
          </select> 
        </div>
      </div><!-- close public_permissions -->


      <fieldset>
        <legend>Share with...</legend>
        <div class="control-group" id="new-group"> 
          <%= label_tag 'generic_file[permissions][new_group_name]', "Group", :class=>"control-label" %>
          <div class="controls">
            <%= text_field_tag 'generic_file[permissions][new_group_name]' %>
            <%= select_tag 'generic_file[permissions][new_group_permission]', options_for_select([['Discover', 'discover'], ['Read', 'read'], ['Edit', 'edit']]) %>
          </div>
        <div>
        <div class="control-group" id="new-user"> 
          <%= label_tag 'generic_file[permissions][new_user_name]', "User", :class=>"control-label" %>
          <div class="controls">
            <%= text_field_tag 'generic_file[permissions][new_user_name]' %>
            <%= select_tag 'generic_file[permissions][new_user_permission]', options_for_select([['Discover', 'discover'], ['Read', 'read'], ['Edit', 'edit']]) %>
          </div>
        <div>
        <ul id="permissions">
          <%=render :partial=>"permission", :collection=>@generic_file.permissions%>
        </ul>
      </fieldset>

      <!-- loop over each term and output form vals -->
  <% @terms.each do |t| %>
    <% next if t.empty? %>
    <% key = t.to_s.split("generic_file__").last %>
    <% vals = @generic_file.send(key) %><br />
    <%# if vals is zero we create an empty array to loop over for output %>
    <% if vals.count == 0 %>
      <% vals = [''] %>
    <% end %>
    <% vals.each_with_index do |v, index| %>
      <div class="control-group" <% if index == 0%> id="additional_<%= key %>_clone" <% end %>>
        <%= f.label key, :class=>"control-label" %> 
        <div class="controls">
          <%= f.text_field :title, :name=>"generic_file[#{key}][]", :value=>v %> 
          <% if index == 0 %>
            <%= f.submit :value => "+", :name=> "additional_#{key}", :id => "additional_#{key}_submit", :class => "adder btn-info btn-mini"  %>
          <% end %>
        </div>
      </div>
    <% end %>
    <div id="additional_<%= key %>_elements"></div>
  <% end %>


    </div> <!-- close .span9 -->
  </div><!-- close .row description section -->

  <div class="form-actions">
    <%= f.submit "Save Changes", :name => "upload_submit", :id => "upload_submit", :class => "btn-primary btn-large" %>
  </div>
<% end %>
  <div class="form-actions">
    <%= button_to "Delete File", generic_file_path(@generic_file), :confirm => "Do you really want to delete this file from ScholarSphere? This action is irreversible.", :method => :delete, :class => "btn-primary btn-large" %>
  </div>
</div><!-- close .uploader-contents -->
