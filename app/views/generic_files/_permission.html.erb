<% depositor = gf.depositor || GenericFile.find(:is_part_of_s => "info:fedora/#{batch.pid}").first.depositor %>
<% public_perm = gf.permissions.map { |perm| perm[:access] if perm[:name] == "public"}.compact.first %>
<% psu_perm = gf.permissions.map { |perm| perm[:access] if perm[:name] == "registered"}.compact.first %>
  <div id="permissions_display">
<input type="hidden" name="generic_file[permissions][group][public]" value="1" />
<input type="hidden" name="generic_file[permissions][group][registered]" value="2" />
<h2>Permissions</h2>
<div class="alert hide" id="save_perm_note">Permissions are <strong>not</strong> saved until the &quot;Save<% if params[:controller] == 'generic_file' %> Permissions<% end %>&quot; button is pressed at the bottom of the page.</div>
<div class="alert alert-error hide" id="permissions_error"><a class="close" data-dismiss="alert" href="#">Ã—</a><span id="permissions_error_text"></span></div>
<div class="well">
  <div class="row">
    <p class="span15 offset52"><a href="" >What's this <i class="icon-question-sign icon-large"></i></a></p>
  </div>
  <div class="control-group">
<<<<<<< HEAD
    <h3>Visibility - <small>who should have the ability to read and download</small></h3>
      <div class="controls">
        <label class="radio">
          <input type="radio" id="visibility_open" name="visibility" value="open" <% if !public_perm.blank? %> checked="true"<% end %>/> <span class="label label-success">Open Access</span> Visible to the world.
        </label>
        <label class="radio">
          <input type="radio" id="visibility_psu" name="visibility" value="psu" <% if !psu_perm.blank? %> checked="true"<% end %> /><span class="label label-info">Penn State</span> Visible to all Penn State users. 
        </label>
        <label class="radio">
          <input type="radio" id="visibility_restricted" name="visibility" value="restricted"<% if psu_perm.blank? and public_perm.blank?%> checked="true"<% end %> /> <span class="label label-important">Private</span> Visible to users/groups specified below, if any. 
        </label>
=======
    <label for="" class="control-label"><h3>Visibility</h3></label> 
    <div class="controls"> 
      <div class="btn-group" data-toggle="buttons-radio" >
        <button type="button" class="btn btn-success<% if !public_perm.blank? %> active<% end %>" data-toggle="button">
          <i class="icon-share"></i> Open Access 
          <input type="radio" name="visibility" value="open" <% if !public_perm.blank? %> checked="true"<% end %>/>
        </button>
        <button type="button" class="btn btn-primary<% if !psu_perm.blank? %> active<% end %> " data-toggle="button">
          <i class="icon-key"></i> Penn State 
          <input type="radio" name="visibility" value="psu" <% if !psu_perm.blank? %> checked="true"<% end %> />
        </button>
        <button type="button" class="btn btn-danger<% if psu_perm.blank? and public_perm.blank?%> active<% end %>" data-toggle="button">
          <i class="icon-ban-circle"></i> Private
          <input type="radio" name="visibility" value="restricted"<% if psu_perm.blank? and public_perm.blank?%> checked="true"<% end %> /> 
        </button>
      </div>
>>>>>>> /bad-path/
    </div><!-- /.controls -->
  </div><!-- /.control-group --> 
  <div class="row">
      <h3>Share With <small>(optional)</small></h3>
  </div>
  <div class="row control-group">
<<<<<<< HEAD
    <div id="new-user"> 
      <div class="input-append">
=======
    <div id="new-group" class="input-prepend">
      <span class="add-on"><i class="icon-group"></i></span>
      <% @groups.unshift('Select a group') %>
      <%= select_tag 'new_group_name_skel', options_for_select(@groups), :class => 'span40' %>
      <%= select_tag 'new_group_permission_skel', options_for_select(ScholarSphere::Application::config.permission_levels), :class => 'span20' %>
      <br /><span id="directory_group_result"></span>
    </div>
  </div>
  <div class="control-group">
    <div id="new-user"> 
      <div class="input-prepend">
        <span class="add-on"><i class="icon-user"></i></span>
        <div class="input-append">
          <%= text_field_tag 'new_user_name_skel', nil, :class => "span31" %><span class="add-on">@psu.edu</span>
            <%= select_tag 'new_user_permission_skel', options_for_select(ScholarSphere::Application::config.permission_levels), :class=> 'span20' %>
         <br /> <span id="directory_user_result"></span> 
        </div>
>>>>>>> /bad-path/
        <p class="help-block">Enter Penn State Access Account Id (one at a time)</p>
        <%= text_field_tag 'new_user_name_skel', nil, :class => "span31" %><span class="add-on">@psu.edu</span>
        <%= select_tag 'new_user_permission_skel', options_for_select(ScholarSphere::Application::config.permission_levels), :class=> 'span17' %>
        <button class="btn btn-mini btn-inverse" id="add_new_user_skel">Add</button>
        <br /> <span id="directory_user_result"></span> 
      </div>
    </div>
  </div>
  <div class="row control-group">
    <div id="new-group" >
      <div class="input-append">
        <% @groups.unshift('Select a group') %>
        <%= select_tag 'new_group_name_skel', options_for_select(@groups), :class => 'span40' %>
        <%= select_tag 'new_group_permission_skel', options_for_select(ScholarSphere::Application::config.permission_levels), :class => 'span17' %>
        <button class="btn btn-mini btn-inverse" id="add_new_group_skel" >Add</button>
        <br /><span id="directory_group_result"></span>
      </div>
    </div>
  </div>
</div><!-- /.well -->
<table class="table table-bordered"> 
  <tr> 
    <th width="60%">Person/Group</th>
    <th width="40%">Access Level</th>
  </tr>
  <tr id="file_permissions">
    <td><%= label_tag :owner_access, "Owner (<span id=\"file_owner\">#{depositor}</span>)".html_safe, :class=>"control-label" %></td>
    <td>
    <%= ScholarSphere::Application::config.owner_permission_levels.keys[0] %>
    </td>
  </tr>
  <% gf.permissions.each do |permission| %>
    <%-# skip the public, penn state (aka registered), and depositor perms as they are displayed first at the top -%>
    <% next if permission[:name].downcase == 'public' %>
    <% next if permission[:name].downcase == 'registered' %>
    <% next if permission[:name].downcase == depositor %>
    <tr>
      <td><%= label_tag "generic_file[permissions][#{permission[:type]}][#{permission[:name]}]", permission[:name], :class=>"control-label" %></td>
      <td>
      <%= select_tag "generic_file[permissions][#{permission[:type]}][#{permission[:name]}]", options_for_select(ScholarSphere::Application::config.permission_levels, permission[:access]), :class=>'span20 select_perm' %>
      <button class="btn close remove_perm">X</button>
      </td>
    </tr>
  <% end %>
</table>
</div><!-- /#permissions_display -->
<div class="row" id="permissions_submit">
  <div class="form-actions">
        <%#= f.submit "Save Permissions", :name => "update_permission", :id => "upload_submit", :class => "btn-primary", :onclick=>"confirmation_needed = false;" %>
    <%= submit_tag "Save Permissions", :name => "update_permission", :id => "upload_submit", :class => "btn-primary", :onclick=>"confirmation_needed = false;" %>
  </div>
</div>
